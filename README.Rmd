---
title: "IMF World Economic Outlook"
author: "Mitsuo Shiota"
date: "2019-05-21"
output: 
  github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Updated: `r Sys.Date()`

## Summary

https://mitsuoxv.shinyapps.io/imf-weo/

IMF World Economic Outlook Databases are great sources for economic analyses. I searched for APIs, but could not find any. So I have decided to download [the entire dataset](https://www.imf.org/external/pubs/ft/weo/2019/01/weodata/download.aspx).


```{r libraries, include=FALSE}
library(tidyverse)

```

The dataset has SDMX data structure, which I don't know. I have searched for packages, and found rsdmx package. With its help, I have managed to transform SDMX data to data frame.

```{r bulk_download, echo=TRUE, cache=FALSE}
tf <- tempfile(tmpdir = tdir <- tempdir()) #temp file and folder
download.file("https://www.imf.org/external/pubs/ft/weo/2019/01/weodata/WEOApr2019_SDMXData.zip", tf)
sdmx_files <- unzip(tf, exdir = tdir)

sdmx <- rsdmx::readSDMX(sdmx_files[1], isURL = FALSE)

weo <- as_tibble(sdmx)

weo$LASTACTUALDATE <- weo$LASTACTUALDATE %>% 
  as.character() %>% 
  as.integer()

weo$TIME_PERIOD <- weo$TIME_PERIOD %>% 
  as.integer()

weo$OBS_VALUE <- weo$OBS_VALUE %>% 
  as.double()

```

I have also downloaded an excel file, which contain meta data. I transform each sheet to data frame, and put it in a list.

```{r meta_data, echo=TRUE, results="hide", message=FALSE, cache=FALSE}
url <- "https://www.imf.org/external/pubs/ft/weo/2019/01/weodata/WEOApr2019_SDMXDSD.XLSX"

httr::GET(url, httr::write_disk(tf2 <- tempfile(fileext = ".xlsx")))

sheets <- readxl::excel_sheets(tf2)

meta <- vector("list", length(sheets))

for (i in seq_along(sheets)) {
  meta[[i]] <- readxl::read_excel(tf2, skip = 7, sheet = sheets[[i]])
}

meta[[5]] <- readxl::read_excel(tf2, skip = 8, col_names = FALSE ,sheet = sheets[[5]])

```
I save data and meta data in a rdata format file to use them later in app.R for Shiny.

```{r save, echo=TRUE}
save(weo, meta, file = "data/weo.rdata")

```

EOL